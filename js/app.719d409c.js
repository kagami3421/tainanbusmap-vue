(function(t){function e(e){for(var o,u,i=e[0],s=e[1],c=e[2],l=0,f=[];l<i.length;l++)u=i[l],a[u]&&f.push(a[u][0]),a[u]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(t[o]=s[o]);d&&d(e);while(f.length)f.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],o=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(o=!1)}o&&(r.splice(e--,1),t=u(u.s=n[0]))}return t}var o={},a={app:0},r=[];function u(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.m=t,u.c=o,u.d=function(t,e,n){u.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},u.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},u.t=function(t,e){if(1&e&&(t=u(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)u.d(n,o,function(e){return t[e]}.bind(null,o));return n},u.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return u.d(e,"a",e),e},u.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},u.p="/tainanbusmapvue/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var d=s;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var o=n("64a9"),a=n.n(o);a.a},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var o=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[t.hasLoaded?n("SideBar",{attrs:{id:"sidebar",routedata:t.savedData},on:{"change-route":t.routeChange,"change-dir":t.directionChange}}):t._e(),t.hasLoaded?n("Map",{attrs:{id:"map",forward:t.showForward,routeData:t.currentRouteData}}):t._e(),n("b-modal",{attrs:{id:"loading",title:"Loading....","no-close-on-backdrop":t.noclick,"ok-only":t.noclick,"ok-disabled":t.noclick,centered:t.noclick}})],1)},r=[],u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("b-navbar",{attrs:{fixed:"top",type:"dark",variant:"info"}},[n("b-navbar-brand",[t._v("臺南市公車路線地圖")]),n("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[n("RouteInfo",{attrs:{routeDesc:t.currentDesc,routeID:t.currentRouteID}}),n("b-navbar-nav",{staticClass:"ml-auto"},[n("RouteSelect",{attrs:{datas:t.routedata},on:{"change-route":t.routeChange}}),n("RouteDirection",{attrs:{isOneWay:t.oneWay},on:{"change-dir":t.routeDirChange}})],1)],1)],1)],1)},i=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-navbar-nav",[n("b-nav-text",[t._v(t._s(t.routeDesc))]),n("b-button",{attrs:{size:"sm",variant:"dark"},on:{click:t.queryBusInfo}},[t._v("路線資訊")])],1)},c=[],d=(n("c5f6"),{name:"RouteInfo",components:{},props:{routeDesc:{type:String,default:""},routeID:{type:Number,default:0}},methods:{queryBusInfo:function(t){window.open("http://www.2384.com.tw/ebus/pathInfo.jsp?pathId="+this.routeID,this.routeID)}}}),l=d,f=n("2877"),p=Object(f["a"])(l,s,c,!1,null,"5db7ef2e",null),h=p.exports,g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-nav-form",[n("b-form-select",{attrs:{options:t.categoryoptions},model:{value:t.categoryselected,callback:function(e){t.categoryselected=e},expression:"categoryselected"}}),n("b-form-select",{attrs:{options:t.routeoptions},on:{change:t.changeroute},model:{value:t.routeselected,callback:function(e){t.routeselected=e},expression:"routeselected"}})],1)},b=[],m=(n("7514"),{name:"RouteSelect",props:{datas:{type:Array,default:function(){return[]}}},computed:{categoryoptions:function(){for(var t=[],e=0;e<this.datas.length;e++){var n=this.datas[e],o={value:n.categoryIndex,text:n.categoryName};t.push(o)}return t},routeoptions:function(){return this.getRouteSelectOptions(this.datas,this.categoryselected)}},data:function(){return{categoryselected:1,routeselected:10450}},watch:{categoryselected:function(){this.detectRouteChange()}},methods:{changeroute:function(t){this.$emit("change-route",this.getRouteSelectData(this.datas,this.categoryselected,t))},getRouteSelectData:function(t,e,n){var o=t.find(function(t){return t.categoryIndex===e}),a=o.routes.find(function(t){return t.RouteCode===n}),r={categoryIndex:o.categoryIndex,routeid:a.RouteCode,osmid:a.RouteOSMRelation,routedesc:a.RouteDescription,mainColor:o.categoryLineColor,extendColor:o.categoryLineColor2,oneWay:a.OneWay};return r},getRouteSelectOptions:function(t,e){for(var n=t.find(function(t){return t.categoryIndex===e}),o=[],a=0;a<n.routes.length;a++){var r=n.routes[a],u={value:r.RouteCode,text:r.RouteName};o.push(u)}return o},detectRouteChange:function(){this.routeselected=this.getRouteSelectOptions(this.datas,this.categoryselected)[0].value,this.changeroute(this.routeselected)}},mounted:function(){this.detectRouteChange()}}),v=m,y=Object(f["a"])(v,g,b,!1,null,"7d4cc089",null),R=y.exports,D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-nav-form",[n("b-form-radio-group",{attrs:{id:"btn-radios-1",options:t.getDirectionOptions,buttons:"","button-variant":"primary",name:"radios-btn-default"},on:{change:t.changedir},model:{value:t.dirselected,callback:function(e){t.dirselected=e},expression:"dirselected"}})],1)},w=[],L={name:"RouteDirection",components:{},props:{isOneWay:{type:Boolean,default:!1}},computed:{getDirectionOptions:function(){var t=[];return!0===this.isOneWay?t.push({text:"往",value:!0}):(t.push({text:"往",value:!0}),t.push({text:"返",value:!1})),t}},methods:{changedir:function(t){this.$emit("change-dir",t)}},data:function(){return{dirselected:!0}}},x=L,S=Object(f["a"])(x,D,w,!1,null,"e13fc080",null),_=S.exports,k=function(t){this.currentDesc=t.routedesc,this.currentRouteID=t.routeid,this.oneWay=t.oneWay,this.$emit("change-route",t)},B=function(t){this.$emit("change-dir",t)},O={name:"SideBar",components:{RouteInfo:h,RouteSelect:R,RouteDirection:_},methods:{routeChange:k,routeDirChange:B},data:function(){return{currentRouteID:10450,currentDesc:"火車站(北)─火車站(北)",oneWay:!1}},props:{routedata:{type:Array,default:function(){return[]}}}},C=O,I=Object(f["a"])(C,u,i,!1,null,"36f0029f",null),j=I.exports,M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("l-map",{ref:"map",attrs:{zoom:t.zoom,center:t.center}},[n("l-tile-layer",{attrs:{url:t.url,attribution:t.attribution}}),t.hasLoaded?n("BusRouteMaster",{attrs:{showForward:t.forward,busRouteMasterData:t.routeGraphData},on:{"return-bound":t.setBounds}}):t._e()],1)],1)},E=[],$=(n("ac6a"),n("5df3"),n("e11e")),A=n.n($),P=n("2699"),N=n("a40a"),T=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("BusRoute",{attrs:{busRouteData:t.switchLineDirection},on:{"get-bound":t.rebounds}})},z=[],W=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("l-feature-group",{ref:"features"},[n("BusLine",{attrs:{busLineData:t.busRouteData.mainLine}}),t.checkExtend?n("BusLine",{attrs:{busLineData:t.busRouteData.extendLine}}):t._e()],1)},F=[],q=n("c5ca"),G=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.checkDataIsExist?n("div",[t._l(t.busLineData.Roads,function(e,o){return n("l-polyline",{key:"Roads_"+o,attrs:{"lat-lngs":e.Points,color:t.busLineData.Color,interactive:!1}})}),t._l(t.busLineData.Stops,function(t,e){return n("BusStop",{key:"Stops_"+e,attrs:{busStopData:t}})})],2):t._e()},J=[],H=n("635f"),K=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("l-marker",{attrs:{"lat-lng":t.busStopData.Position}},[n("l-icon",{attrs:{"icon-url":t.iconLocation,"icon-size":t.iconSize}}),n("l-popup",[n("h5",[t._v(t._s(t.busStopData.Name))]),n("br"),t._v("站牌代碼："),n("b",[t._v(t._s(t.busStopData.ID))]),n("br"),n("b-button",{attrs:{size:"sm"},on:{click:t.queryRealtime}},[t._v("經過路線/動態")])],1)],1)},Q=[],U=n("4e2b"),V=n("f60f"),X=n("fbba"),Y={name:"BusStop",components:{LMarker:U["a"],LPopup:V["a"],LIcon:X["a"]},props:{busStopData:{type:Object,default:function(){}}},data:function(){return{iconSize:[20,20]}},methods:{queryRealtime:function(t){window.open("http://www.2384.com.tw/qrcode/vstop?code="+this.busStopData.ID,this.busStopData.ID)}},computed:{iconLocation:function(){return"./Icons/busIcon"+this.busStopData.CategoryIndex+".png"}}},Z=Y,tt=Object(f["a"])(Z,K,Q,!1,null,"c1fe61ae",null),et=tt.exports,nt={name:"BusLine",components:{LPolyline:H["a"],BusStop:et},props:{busLineData:{type:Object,default:function(){}}},computed:{checkDataIsExist:function(){return void 0!==this.busLineData}}},ot=nt,at=Object(f["a"])(ot,G,J,!1,null,"7bfd7f89",null),rt=at.exports,ut={name:"BusRoute",components:{LFeatureGroup:q["a"],BusLine:rt},props:{busRouteData:{type:Object,default:function(){}}},computed:{checkExtend:function(){return void 0!==this.busRouteData.extendLine}},updated:function(){var t=this.$refs.features.mapObject.getBounds();this.$emit("get-bound",t)}},it=ut,st=Object(f["a"])(it,W,F,!1,null,"7b98330c",null),ct=st.exports,dt={name:"BusRouteMaster",components:{BusRoute:ct},props:{busRouteMasterData:{type:Object,default:function(){}},showForward:{type:Boolean,default:!0}},computed:{switchLineDirection:function(){return!0===this.showForward?this.busRouteMasterData.forwardRoute:this.busRouteMasterData.backwardRoute}},methods:{rebounds:function(t){this.$emit("return-bound",t)}}},lt=dt,ft=Object(f["a"])(lt,T,z,!1,null,"565aabf0",null),pt=ft.exports,ht=n("bc3a"),gt=n.n(ht);function bt(t){for(var e={mainLine:[],extendLine:[]},n={mainLine:[],extendLine:[]},o={forwardRoute:e,backwardRoute:n},a=t.getElementsByTagName("relation"),r=0;r<a.length;r++)for(var u=a[r],i=u.getElementsByTagName("member"),s=0;s<i.length;s++)if("relation"===i[s].getAttribute("type"))switch(i[s].getAttribute("role")){case"forward":o.forwardRoute.mainLine.push(i[s].getAttribute("ref"));break;case"backward":o.backwardRoute.mainLine.push(i[s].getAttribute("ref"));break;case"forward_extend":o.forwardRoute.extendLine.push(i[s].getAttribute("ref"));break;case"backward_extend":o.backwardRoute.extendLine.push(i[s].getAttribute("ref"));break}return o}function mt(t){var e=[],n=vt(t),o=yt(t,n);for(var a in n){var r=n[a];Dt(r)&&e.push(r)}for(var u=0;u<o.length;u++){var i=o[u];e.push(i)}return e}function vt(t){for(var e={},n=t.getElementsByTagName("node"),o=0;o<n.length;o++){var a=n[o],r=a.getAttribute("id");e[r]={id:r,type:"node",latLng:[a.getAttribute("lat"),a.getAttribute("lon")],tags:Rt(a)}}return e}function yt(t,e){for(var n=[],o=t.getElementsByTagName("way"),a=0;a<o.length;a++){for(var r=o[a],u=r.getElementsByTagName("nd"),i={id:r.getAttribute("id"),type:"way",nodes:new Array(u.length),tags:Rt(r)},s=0;s<u.length;s++)i.nodes[s]=e[u[s].getAttribute("ref")];n.push(i)}return n}function Rt(t){for(var e={},n=t.getElementsByTagName("tag"),o=0;o<n.length;o++)e[n[o].getAttribute("k")]=n[o].getAttribute("v");return e}function Dt(t){var e=!1;for(var n in t.tags)if("bus_stop"==t.tags[n]){e=!0;break}return e}var wt="https://api.openstreetmap.org/api/0.6/relation/",Lt="/full",xt={name:"Map",components:{LMap:P["a"],LTileLayer:N["a"],BusRouteMaster:pt},data:function(){return{zoom:13,center:A.a.latLng(22.9981,120.2151),url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',hasLoaded:!1,routeGraphData:{}}},props:{forward:{type:Boolean,default:!0},routeData:{type:Object,default:function(){}}},watch:{routeData:function(){var t=this;this.hasLoaded=!1,this.$bvModal.show("loading"),this.handleRouteMaster(this.routeData.osmid).then(function(e){return t.buildData(e)}).then(function(e){t.hasLoaded=!0,t.routeGraphData=e,t.$bvModal.hide("loading")})}},methods:{handleRouteMaster:function(t){return new Promise(function(e,n){var o=e;gt.a.get(wt+t,{responseType:"document",headers:{Accept:" text/plain, */*"}}).then(function(t){o(bt(t.data))}).catch(function(t){console.log(t)})})},handleSingleRoute:function(t){return new Promise(function(e,n){for(var o=e,a=[],r=[],u=0;u<t.length;u++)a.push(gt.a.get(wt+t[u]+Lt,{responseType:"document",headers:{Accept:" text/plain, */*"}}));Promise.all(a).then(function(t){for(var e=0;e<t.length;e++)r.push(mt(t[e].data));o(r)})})},buildData:function(t){var e=this,n=this;return new Promise(function(o,a){var r={mainLine:void 0,extendLine:void 0},u={mainLine:void 0,extendLine:void 0},i={forwardRoute:r,backwardRoute:u};0!==t.forwardRoute.mainLine.length&&e.handleSingleRoute(t.forwardRoute.mainLine).then(function(t){i.forwardRoute.mainLine=n.constructSingleRouteData(t,!0)}),0!==t.forwardRoute.extendLine.length&&e.handleSingleRoute(t.forwardRoute.extendLine).then(function(t){i.forwardRoute.extendLine=n.constructSingleRouteData(t,!1)}),0!==t.backwardRoute.mainLine.length&&e.handleSingleRoute(t.backwardRoute.mainLine).then(function(t){i.backwardRoute.mainLine=n.constructSingleRouteData(t,!0)}),0!==t.backwardRoute.extendLine.length&&e.handleSingleRoute(t.backwardRoute.extendLine).then(function(t){i.backwardRoute.extendLine=n.constructSingleRouteData(t,!1)}),o(i)})},constructSingleRouteData:function(t,e){var n={Stops:[],Roads:[],Color:""};n.Color=!0===e?this.routeData.mainColor:this.routeData.extendColor;for(var o=0;o<t.length;o++)for(var a=t[o],r=0;r<a.length;r++){var u=a[r];if("node"===u.type){var i={Name:this.getBusStopName(u.tags),ID:this.getBusStopCode(u.tags),CategoryIndex:this.routeData.categoryIndex,Position:u.latLng};n.Stops.push(i)}else{for(var s={Points:[]},c=0;c<u.nodes.length;c++)s.Points.push(u.nodes[c].latLng);n.Roads.push(s)}}return n},getBusStopName:function(t){var e="";for(var n in t)if("name"==n){e=t[n];break}return e},getBusStopCode:function(t){var e=0;for(var n in t)if("ref"==n){e=t[n];break}return e},setBounds:function(t){this.$refs.map.mapObject.fitBounds(t)}}},St=xt,_t=Object(f["a"])(St,M,E,!1,null,"4a497a4c",null),kt=_t.exports,Bt=function(t){this.currentRouteData=t},Ot=function(t){this.showForward=t},Ct={name:"app",data:function(){return{noclick:!0,hasLoaded:!1,savedData:[],showForward:!0,currentRouteData:{categoryIndex:1,routeid:10450,osmid:4016613,routedesc:"火車站(北)─火車站(北)",mainColor:"#9900CC",extendColor:"#D699EB"}}},components:{SideBar:j,Map:kt},methods:{routeChange:Bt,directionChange:Ot},created:function(){var t=this;gt.a.get("./AllBusRoutes.json").then(function(e){t.savedData=e.data,t.hasLoaded=!0})}},It=Ct,jt=(n("034f"),Object(f["a"])(It,a,r,!1,null,null,null)),Mt=jt.exports,Et=n("5f5b");n("21b6"),n("2dd8"),n("6cc5");o["default"].config.productionTip=!1,o["default"].use(Et["a"]),new o["default"]({render:function(t){return t(Mt)}}).$mount("#app")},"64a9":function(t,e,n){}});
//# sourceMappingURL=app.719d409c.js.map